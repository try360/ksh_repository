<%@ page language="java" contentType="text/html; charset=EUC-KR" pageEncoding="EUC-KR"%>
<%@ taglib prefix="spring" uri="http://www.springframework.org/tags" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %> 
<%@ taglib prefix="custom" uri="/tags/custom-taglib" %> 
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %> 
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<jsp:useBean id="paramFn" class="kr.co.kt.common.ParamValidatChk" />
<% pageContext.setAttribute("enter", "\n"); %>
<!DOCTYPE html>
<html lang="ko">
<head>
<%@ include file = "/resources/inc/meta.jsp" %>
<script src="/resources/js/IP-Input-Control-jQuery-ipInput/ipInput.min.js" charset="utf-8"></script>
<link rel="stylesheet" href="/resources/js/IP-Input-Control-jQuery-ipInput/ipInput.min.css">
<script type="text/javascript" src="/resources/js/business4p.js?ver=1.1.9" charset="utf-8" ></script>
<link rel="stylesheet" href="/resources/css/business4p.css?ver=1.1.7">
</head>
<body>
<%@ include file = "/resources/inc/header_nav.jsp" %>
<%@ include file = "/resources/inc/aside.jsp" %>
<c:if test="${requestView.business_cd eq '01' }"> <c:set value="신/증설" var = "business_cd"/></c:if>
<c:if test="${requestView.business_cd eq '02' }"> <c:set value="돌발" var = "business_cd"/></c:if>
<section>
    <h1 class="list">4P-AGW</h1>

    <div class="contents_form">
        <!-- 타이틀, 경로 -->
        <div class="divDocTitle">수요 공급 요청</div>
        <!-- VIEW -->
        <div id="breadcrumb"><div class="line"></div>
			  <ul>
			    <li id="p_01" <c:if test="${requestView.status_cd eq '01'}"> class="active"</c:if>>투자확정</li>
			    <li id="p_02" <c:if test="${requestView.status_cd eq '02'}"> class="active"</c:if>>IP&MAC확정</li>
			    <li id="p_03" <c:if test="${requestView.status_cd eq '03'}"> class="active"</c:if>>MGID확정</li>
			    <li id="p_04" <c:if test="${requestView.status_cd eq '04'}"> class="active"</c:if>>착공(공사요청)</li>
			    <li id="p_05" <c:if test="${requestView.status_cd eq '05'}"> class="active"</c:if>>COLCODE확정</li>
			    <li id="p_06" <c:if test="${requestView.status_cd eq '06'}"> class="active"</c:if>>준공(설치완료)</li> 
			  </ul>
		</div>
		<div class="topBtnArea">
	        <div class="leftBtnArea">
	        <c:if test="${next_no != 0 }">
	            <a href="request_view?rstNo=${next_no }"><img class="srchIcon" src="/resources/img/btn_bbs_prev.gif" alt="다음" /></a>
	        </c:if>
	        <c:if test="${prev_no != 0 }">
	            <a href="request_view?rstNo=${prev_no }"><img class="srchIcon" src="/resources/img/btn_bbs_next.gif" alt="이전" /></a>
	        </c:if>   
	        </div>
	        <div class="btnArea">
	        <c:if test="${authChk.a0_mail eq 'Y'}">
 				<img alt="재발송" class="reSending" src="/resources/img/btn_resend.png" />
 		 	</c:if>
	        <c:if test="${authChk.a0 eq 'Y'}">
	           <c:if test="${requestView.status_cd eq '99'}" >
	           		<form method="POST" name="reject_request_form" id="reject_request_form" action="process_write" target="pageRefreshing">
	           		<input type="text" name="neoss_no" id="neoss_no" value="${requestView.neoss_no}">
			        <input type="text" name="status_cd" id="status_cd" value="${requestView.status_cd}">
			        <input type="text" name="request_yn" id="request_yn" value="${requestView.request_yn}">
			        <input type="text" name="olt_user_id" id="olt_user_id" value="${modelInfo_view.olt_user_id}">
			        <input type="text" name="no_emp" id="no_emp" value="${confirmNo_emp.st_01}">
	           		</form>
	           		<img class="reject_request" src="/resources/img/btn_rst.gif" alt="승인요청" />
	           		<img class="delIcon" src="/resources/img/btn_delete.gif" id="deleteBtn" style="cursor:pointer" alt="삭제" />
	           	</c:if>
	           	<c:if test="${requestView.status_cd ne '99' && sessionScope.role eq '02' }">
           		<img class="delIcon" src="/resources/img/btn_delete.gif" id="deleteBtn" style="cursor:pointer" alt="삭제" />
           		</c:if>
	            <a href="javascript:void(0);" onclick="popLink('request?neoss_no=${requestView.neoss_no }&flag=1&modFlag=1', 820, 900);"><img id="modifyRun" class="srchIcon" src="/resources/img/btn_modify.gif" alt="수정" /></a> 
	       </c:if>
	            <img src="/resources/img/btn_print.png" alt="인쇄" class="btnPrint" />
	            <a href="list?${pageInfo.param }"><img class="srchIcon" src="/resources/img/btn_list.gif" alt="목록" /></a>
	        </div>
        </div>
        		
        <table class="viewTable" id="viewTable" border="0" cellspacing="0" cellpadding="0">
            <tbody>
            <tr>
                <th>문서번호</th>
                <td><b>${requestView.doc_no}</b></td>
                <th>공급요청자</th>
                <td>${requestView.emp_name} (${requestView.input_dt})</td>
            </tr>
            <tr>
                <th>조직</th>
                <td>${requestView.office_nm }</td>
                <th>공급일</th>
                <td>${requestView.supply_dt }&nbsp;</td>
            </tr>
            <tr>
                <th>건물형태</th>
                <td>${requestView.build_nm} > ${requestView.buildshape_nm }  > ${requestView.section_nm } </td>
                <th>공급직영여부</th>
                <td>${requestView.direct_yn ? '직영(협력사에 메일 발송 안됨)' : '-' }</td>
            </tr>
            <tr>
                <th>설치주소</th>
                <td colspan="3">(${requestView.post }) ${requestView.address_old }&nbsp;${requestView.address2 }</td>
            </tr>
          	</tbody>
        </table>

        <table class="viewTable" width="100%" border="0" cellspacing="0" cellpadding="0">
            <tbody>
            <tr>
                <th>공급구분</th>
                <td>${requestView.supply_cd }</td>
                <th>공급사유</th>
                <td>${requestView.reason_nm }&nbsp;[상세사유: ${requestView.reason }]</td>
            </tr>
            <tr>
                <th>청약전화번호</th>
                <td>${paramFn.toTelNum(requestView.telnum) }</td>
                <th>OSPIA 번호</th>
                <td>${requestView.ospia }</td>
            </tr>
        </table>
        <table class="viewTable" width="100%" border="0" cellspacing="0" cellpadding="0">
			<tr>
				<th class="w30" rowspan="4">공<br>급<br>내<br>역</th>
				<th>장비수</th>
				<td>${requestView.device_num }대</td>
				<th class="w30" rowspan="4">공<br>급<br>회<br>선</th>
       			<th>세대수</th>
       			<td >${requestView.household_no } 세대</td>
       			<th class="w30" rowspan="4">소<br>요<br>경<br>비<br>(원)</th>
       			<th>물자비</th>
       			<td><span class="wonArea"><fmt:formatNumber value="${requestView.expense1}" pattern="#,###"/></span></td>
       		</tr>
       		<tr>
       			<th>선로방식</th>
       			<td>${requestView.line_type }차RN</td>
       			<th>시장점유율</th>
       			<td >${requestView.share_nm}</td>
       			<th>공사비</th>
       			<td ><span class="wonArea"><fmt:formatNumber value="${requestView.expense2}" pattern="#,###"/></span></td>
       		</tr>
       		<tr>
       			<th>전원협정여부</th>
       			<td>${requestView.agree_yn == 'true'?'완료':'미완료' }</td>
       			<th>공급회선</th>
       			<td>${requestView.model_num }회선</td>
       			<th>경비</th>
       			<td ><span class="wonArea"><fmt:formatNumber value="${requestView.expense3}" pattern="#,###"/></span></td>
       		</tr>
       		<tr>
       			<th>전원공사</th>
       			<td>${requestView.power_yn == 'true'?'필요':'불필요' }</td>
       			<th>공급장비</th>
       			<td>${requestView.model_nm }</td>
       			<th>계</th>
       			<td ><span class="wonArea"><strong><fmt:formatNumber value="${requestView.tot_expense}" pattern="#,###"/></strong></span></td>
       		</tr>
       	</table>
       	
       	<c:if test="${not empty modelInfo_view.olt_user_id }">
       	<table class="viewTable" width="100%" border="0" cellspacing="0" cellpadding="0">
       		<tbody>
       		<tr>
       			<th rowspan="3">OLT정보</th>
       			<th>설치국사</th>
       			<td>${modelInfo_view.kuksa_nm }</td>
       			<th>OLT이름</th>
       			<td>${modelInfo_view.olt_nm }</td>
       			<th>포트번호<br>INET-Tie</th>
       			<td>${modelInfo_view.inet_tie }</td>
       		</tr>
       		<tr>
       			<th>Default Gateway</th>
       			<td>${modelInfo_view.gw_ip }</td>
       			<th>Subnet Mask</th>
       			<td>${modelInfo_view.subnetmask }</td>
       			<th>OLT IP<br>(고정 IP)</th>
       			<td>${modelInfo_view.managed_ip }
       		</tr>
       		<tr>
       			<th>등록자</th>
       			<td colspan="5"><b>${modelInfo_view.olt_user_name }</b> (${paramFn.toTelNum(modelInfo_view.olt_phone_number) }) - ${modelInfo_view.olt_dept_name } </td>
       		</tr>
       	</table>
       	</c:if>
       	
       	<c:if test="${not empty modelInfo_view.pots_user_id }">
       	<table class="viewTable" width="100%" border="0" cellspacing="0" cellpadding="0">
       		<tr>
       			<th rowspan="3">POTS 정보</th>
       			<th>POTS</th>
       			<td>
       				<c:if test="${not empty md_list }">
       					<c:forEach var="pots_list" items="${md_list }">
       						<c:if test="${pots_list.id == modelInfo_view.pots_id }">
       							${pots_list.nm } (${pots_list.ip })
       						</c:if>
       					</c:forEach>
       				</c:if>
       			</td>
       			<th>MGID</th>
       			<td>${modelInfo_view.mg_id }</td>
       			<th>START_LLN</th>
       			<td>${modelInfo_view.start_lln }</td>
       		</tr>
       		<tr>
       			<th>AGW IP</th>
       			<td>${modelInfo_view.megaco_ip }</td>
       			<th>IPSec-서버IP</th>
       			<td>
       				<c:if test="${not empty md_list2 }">
       					<c:forEach var="ipsec_list" items="${md_list2 }">
       						<c:if test="${ipsec_list.id == modelInfo_view.ipsec_ip }">
       							${ipsec_list.nm } (${ipsec_list.ip })
       						</c:if>
       					</c:forEach>
       				</c:if>
       			</td>
       			<th>EMS IP</th>
       			<td>
       				<c:if test="${not empty md_list3 }">
       					<c:forEach var="emsIp_list" items="${md_list3 }">
       						<c:if test="${emsIp_list.id == modelInfo_view.ipsec_ip }">
       							${emsIp_list.mih_ip }<br>
       							(${emsIp_list.ktis_ip })
       						</c:if>
       					</c:forEach>
       				</c:if>
       			</td>
       		</tr>
       		<tr>
       			<th>등록자</th>
       			<td colspan="5"><b>${modelInfo_view.pots_user_name }</b> (${paramFn.toTelNum(modelInfo_view.pots_phone_number) }) - ${modelInfo_view.pots_dept_name } </td>
       		</tr>
       	</table>
       	</c:if>
       	
       	<c:if test="${not empty modelInfo_view.fm_user_id }">
       	<table class="viewTable" width="100%" border="0" cellspacing="0" cellpadding="0">
       		<tr>
       			<th rowspan="3">장비시설정보</th>
       			<th>COLCODE</th>
       			<td>${modelInfo_view.colcode }</td>
       			<%-- <th>본부>센터>팀</th>
       			<td>${modelInfo_view.office_nm }</td> --%>
       		</tr>
       		<%-- <tr>
       			<th>주소</th>
       			<td colspan="3">${modelInfo_view.address }</td>
       		</tr> --%>
       		<tr>
       			<th>등록자</th>
       			<td><b>${modelInfo_view.fm_user_name }</b> (${paramFn.toTelNum(modelInfo_view.fm_phone_number) }) - ${modelInfo_view.fm_dept_name } </td>
       		</tr>
       	</table>
       	</c:if>
       	
       	<c:if test="${not empty modelInfo_view.mac_user_id }">
       	<table class="viewTable" width="100%" border="0" cellspacing="0" cellpadding="0">
       		<tr>
       			<th rowspan="2">MAC확정<br>& EMS 전송</th>
       			<th>MAC</th>
       			<td colspan="3">${modelInfo_view.mac }</td>
       		</tr>
       		<tr>
       			<th>등록자</th>
       			<td colspan="3"><b>${modelInfo_view.mac_user_name }</b> (${paramFn.toTelNum(modelInfo_view.mac_phone_number) }) - ${modelInfo_view.mac_dept_name } </td>
       		</tr>
       	</table>
       	</c:if>
       	
        <c:if test="${not empty csVO}">
        <table class="viewTable" width="100%" border="0" cellspacing="0" cellpadding="0">
            <tbody>
            <tr>
            	<th class="w30" rowspan="7">착<br><br>공</th>
            	<th>착공일</th>
                <td>${csVO.st_dt }</td>                
            </tr>
            <tr>
                <th>협력사</th>
               	<td>
               		<c:if test="${not empty csmemVO }">
               			<c:forEach items="${csmemVO }" var="vo">
               		<b>${vo.emp_name }</b> (${vo.email_address }) - ${vo.dept_name }<br>
               			</c:forEach>
               		</c:if>
               	</td>
            </tr>
            <tr>
             	<th>검토의견</th>
                <td>${csVO.const_st_desc }</td>
            </tr>
        </table>
        </c:if>
        <c:if test="${not empty attachList }">
		<h5>· 첨부파일</h5>
        <table class="viewTable" width="100%" border="0" cellspacing="0" cellpadding="0">
            <tbody>
            <tr>
                <th>문서</th>
                <td>
            		<ul id="attachList" >
						<c:forEach var="vo" items="${attachList }">
						<c:set var="filesize" value="${vo.filesize }" />
						<c:set var="KBfilesize" value="${filesize/1024 }" />
						<c:set var="MBfilesize" value="${KBfilesize/1024 }" />
						<fmt:formatNumber var="KBfilesize" value="${KBfilesize }" pattern="#.#" />
						<fmt:formatNumber var="MBfilesize" value="${MBfilesize }" pattern="#.#" />
						<c:set var="format" value="${fn:substring(vo.filename_n, fn:indexOf(vo.filename_n,'.')+1, fn:length(vo.filename_n)) }"/> <!-- 확장자 구분하기 -->
						<c:choose>
						<c:when test = "${format eq 'jpg' || format eq 'png' || foramt eq 'gif' || format eq 'bmp' || format eq 'JPG' || format eq 'PNG' || format eq 'GIF' || format eq 'BMP'}">
						</c:when>
						<c:otherwise>
						<li><a href="/fileDownload?no=${vo.attach_no }">${vo.filename }</a> <em>(${(filesize<1048576)? KBfilesize : MBfilesize }${(filesize<1048576)? 'K' : 'M' }B)</em></li>
						</c:otherwise>
						</c:choose>
						</c:forEach>
					</ul>
            	</td>
            </tr>
            <tr>
            <th>이미지</th>
            <td>
            	<ul class="imageList">
						<c:forEach var="vo" items="${attachList }">
						<c:set var="filesize" value="${vo.filesize }" />
						<c:set var="KBfilesize" value="${filesize/1024 }" />
						<c:set var="MBfilesize" value="${KBfilesize/1024 }" />
						<fmt:formatNumber var="KBfilesize" value="${KBfilesize }" pattern="#.#" />
						<fmt:formatNumber var="MBfilesize" value="${MBfilesize }" pattern="#.#" />
						<c:set var="format" value="${fn:substring(vo.filename_n, fn:indexOf(vo.filename_n,'.')+1, fn:length(vo.filename_n)) }"/> <!-- 확장자 구분하기 -->
						<c:if test = "${format eq 'jpg' || format eq 'png' || foramt eq 'gif' || format eq 'bmp' || format eq 'JPG' || format eq 'PNG' || foramt eq 'GIF' || format eq 'BMP'}">
						<li><img id="img${vo.attach_no }" class="imgli" src="/resources/upload/${vo.filepath}${vo.filename_n}" />
						<p><a href="/fileDownload?no=${vo.attach_no }">${vo.filename }</a></p></li>
						</c:if>
						</c:forEach>
					</ul>
				</td>
            </tr>
            </tbody>
        </table>
        </c:if>
        
        <h5>· 승인 담당자</h5>
        <table class="writeTable" width="100%" border="0" cellspacing="0" cellpadding="0">
            <thead>
            <tr>
                <th>투자확정<p>${list01.get(0).dept_name }</p></th>
                <th>IP/MAC확정<p>${list02.get(0).dept_name }</p></th>
                <th>MGID확정<p>${list03.get(0).dept_name }</p></th>
                <th>착공(공사요청)<p>${list04.get(0).dept_name }</p></th>
                <th>COLCODE확정<p>${list05.get(0).dept_name }</p></th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td class="ntpd">
                    <div class="manageArea">
                        <c:if test="${not empty list01 }">
                        <ul>
                        	<c:forEach items="${list01 }" var="userVO">
                            <li>${userVO.emp_name } (${paramFn.toTelNum(userVO.phone_number) })
                            	<input type="hidden" name="user_no_01" id="user_no_01" value="${userVO.user_no }"/>
                            </li>
                            </c:forEach>
                        </ul>
                        </c:if>
                    </div>
                </td>
                <td class="ntpd">
                    <div class="manageArea">
                        <c:if test="${not empty list02 }">
                        <ul>
                        	<c:forEach items="${list02 }" var="userVO">
                            <li>${userVO.emp_name } (${paramFn.toTelNum(userVO.phone_number) })
                            	<input type="hidden" name="user_no_02" id="user_no_02" value="${userVO.user_no }"/>
                            </li>
                            </c:forEach>
                        </ul>
                        </c:if>
                    </div>
                </td>
                <td class="ntpd">
                    <div class="manageArea">
                        <c:if test="${not empty list03 }">
                        <ul>
                        	<c:forEach items="${list03 }" var="userVO">
                            <li>${userVO.emp_name } (${paramFn.toTelNum(userVO.phone_number) })
                            	<input type="hidden" name="user_no_03" id="user_no_03" value="${userVO.user_no }"/>
                            </li>
                            </c:forEach>
                        </ul>
                        </c:if>
                    </div>
                </td>
                <td class="ntpd">
                    <div class="manageArea">
                        <c:if test="${not empty list04 }">
                        <ul>
                        	<c:forEach items="${list04 }" var="userVO">
                            <li>${userVO.emp_name } (${paramFn.toTelNum(userVO.phone_number) })
                            	<input type="hidden" name="user_no_04" id="user_no_04" value="${userVO.user_no }"/>
                            </li>
                            </c:forEach>
                        </ul>
                        </c:if>
                    </div>
                </td>
                <td class="ntpd">
                    <div class="manageArea">
                        <c:if test="${not empty list05 }">
                        <ul>
                        	<c:forEach items="${list05 }" var="userVO">
                            <li>${userVO.emp_name } (${paramFn.toTelNum(userVO.phone_number) })
                            	<input type="hidden" name="user_no_05" id="user_no_05" value="${userVO.user_no }"/>
                            </li>
                            </c:forEach>
                        </ul>
                        </c:if>
                    </div>
                </td>
            </tr>

            </tbody>
        </table>
        
        <div class="leftBtnArea">
        <c:if test="${next_no != 0 }">
            <a href="request_view?rstNo=${next_no }"><img class="srchIcon" src="/resources/img/btn_bbs_prev.gif" alt="다음" /></a>
        </c:if>
        <c:if test="${prev_no != 0 }">
            <a href="request_view?rstNo=${prev_no }"><img class="srchIcon" src="/resources/img/btn_bbs_next.gif" alt="이전" /></a>
        </c:if>   
        </div>
        <div class="btnArea">
         <c:if test="${authChk.a0_mail eq 'Y'}">
 			<img alt="재발송" class="reSending" src="/resources/img/btn_resend.png" />
 		 </c:if>
         <c:if test="${authChk.a0 eq 'Y'}">
           <c:if test="${requestView.status_cd eq '99'}" >
           		<img class="reject_request" src="/resources/img/btn_rst.gif" alt="반려된 건을 다시 요청" />
           		<img class="delIcon" src="/resources/img/btn_delete.gif" id="deleteBtn" style="cursor:pointer" alt="삭제" />
           	</c:if>
           	<c:if test="${requestView.status_cd ne '99' && sessionScope.role eq '02' }">
         		<img class="delIcon" src="/resources/img/btn_delete.gif" id="deleteBtn" style="cursor:pointer" alt="삭제" />
         	</c:if>
            <a href="javascript:void(0);" onclick="popLink('request?neoss_no=${requestView.neoss_no}&flag=1&modFlag=1', 820, 900);"><img id="modifyRun" class="srchIcon" src="/resources/img/btn_modify.gif" alt="수정" /></a> 
         </c:if>
            <img src="/resources/img/btn_print.png" alt="인쇄" class="btnPrint" />
            <a href="list?${pageInfo.param }"><img class="srchIcon" src="/resources/img/btn_list.gif" alt="목록" /></a>
        </div>

        <div class="tabArea">
        <div class="divDocTitle pt50">승인 및 반려</div>
			<div id="tabs">
				<ul>
					<li id="tabs01" data="${pr_contents.process_no_01 }"><a href="#tabs-1">투자확정</a></li>
					<li id="tabs02" data="${pr_contents.process_no_02 }"><a href="#tabs-2">IP & MAC확정</a></li>
					<li id="tabs03" data="${pr_contents.process_no_03 }"><a href="#tabs-3">MGID확정</a></li>
					<li id="tabs04" data="${pr_contents.process_no_04 }"><a href="#tabs-4">착공(공사요청)</a></li>
					<li id="tabs05" data="${pr_contents.process_no_05 }"><a href="#tabs-5">COLCODE확정</a></li>
					<!-- <li id="tabs07"><a href="#tabs-7" >준공</a></li> -->
				</ul>
				
				<form method="POST" name="modelInfoForm" id="modelInfoForm" action="process_write" target="pageRefreshing" onSubmit="return FormChkModule(this);">
				<input type="hidden" name="neoss_no" id="neoss_no" value="${requestView.neoss_no}">
				<input type="hidden" name="constNo" value="${csVO.const_no}"/>
				<input type="hidden" name="prev_status" id="prev_status" value="">
				<input type="hidden" name="status_cd" id="status_cd" value="${requestView.status_cd}">
				<input type="hidden" name="request_yn" id="request_yn" value="${requestView.request_yn}">
				<input type="hidden" name="status" id="status" value="${requestView.status_next}">
				<input type="hidden" name="contents" />
				<input type="hidden" name="process_no" id="process_no" value="0" />
				<input type="hidden" name="doc_no" id="doc_no" value="${requestView.doc_no}">
				<!-- tabs-1 투자확정 -->
				<div id="tabs-1" >
					<table class="writeTable" border="0" cellspacing="0" cellpadding="0">
						<tbody>
						<tr>
							<th>의견 작성</th>
							<td>
								<textarea id="reply_write_contents_01" name= "reply_write_contents_01"  placeholder="의견 작성" >${pr_contents.contents_01 }</textarea>
							</td>
						</tr>
						</tbody>
					</table>
                     
					<div class="btnArea">
					<c:if test="${authChk.a1_mail eq 'Y' }">
	                     	<button type="button" class="button reSending" value="재발송">재발송</button>
                     </c:if>
					<c:if test ="${ authChk.a1 eq 'Y' }">
						<c:if test="${requestView.status_cd eq '01' }">
							<button class="button" value="${requestView.status_next }">${requestView.status_next }</button>
							<c:if test="${requestView.status_cd ne '99'}"><button type="button" class="button rejectBtn" value="반려">반려</button></c:if>
						</c:if>
						<c:if test="${requestView.status_cd ne '01'}">
							<button class="button modify" value="수정">수정</button>
						</c:if>					
					</c:if>
					</div>
				</div>
                
                <!-- tabs-2 IP확정 -->
	         	<div id="tabs-2">
					<table class="writeTable" border="0" cellspacing="0" cellpadding="0">
						<tr class="default"><th><td style="width:320px;"></td><th></th><td style="width:230px;"></td><th></th><td></td></tr>
						<tbody>
						<tr>
							<th>설치국사</th>
							<td><input type="text" name="kuksa_nm" maxlength="25" value="${modelInfo_view.kuksa_nm }" /></td>
							<th>OLT이름</th>
							<td><input type="text" name="olt_nm" maxlength="25" value="${modelInfo_view.olt_nm }" /></td>
							<th>INET Tie</th>
							<td><input type="text" name="inet_tie" maxlength="40" value="${modelInfo_view.inet_tie }" /></td>
						</tr>
						<tr>
							<th>OLT IP<br>(고정 IP)</th>
							<td>
								<div id="managedIP"></div>
								<input type="hidden" name="managed_ip" maxlength="15" id="managed_ip" value="${modelInfo_view.managed_ip}" placeholder="OLT IP" />
								<input type="hidden" name="managedIpDupliChk" id="managedIpDupliChk" value="${modelInfo_view.managed_ip }" />
								<button type="button" class="button dupliIPChk">중복체크</button>
							</td>
							<th>GATEWAY</th>
							<td>
								<div id="gwIP"></div>
								<input type="hidden" name="gw_ip" maxlength="15" id="gw_ip" value="${modelInfo_view.gw_ip }"/>
							</td>
							<th>SUBNET MASK</th>
							<td>
								<select name="subnetmask" id="subnetmask">
									<option value="24" <c:if test="${modelInfo_view.subnetmask == '24' }">selected="selected"</c:if>>/ 24</option>
									<option value="25" <c:if test="${modelInfo_view.subnetmask == '25' }">selected="selected"</c:if>>/ 25</option>
									<option value="26" <c:if test="${modelInfo_view.subnetmask == '26' }">selected="selected"</c:if>>/ 26</option>
									<option value="27" <c:if test="${modelInfo_view.subnetmask == '27' }">selected="selected"</c:if>>/ 27</option>
									<option value="28" <c:if test="${modelInfo_view.subnetmask == '28' }">selected="selected"</c:if>>/ 28</option>
									<option value="29" <c:if test="${modelInfo_view.subnetmask == '29' }">selected="selected"</c:if>>/ 29</option>
								</select>
							</td>
						</tr>
						<tr>
							<th rowspan="2">MAC 정보</th>
							<td colspan="5" style="color:red;">※ 오타 방지를 위해 'MAC 입력'시 <u>자동완성 목록</u>에서 선택 입력 부탁드립니다.</td>
						</tr>
						<tr>
	                        <td>
	                        	<input type="text" name="mac_before" value="1853E0" readonly="readonly" /> 
	                        	<input type="text" name="mac_after" id="macAutoComplete" maxlength="6" />
	                        	<input type="hidden" name="mac" id="mac" value="${modelInfo_view.mac }" />
	                        </td>
	                        <th>Epon MAC</th>
	                        <td colspan="3"><input type="text" id="epon_mac" name="epon_mac" value="${paramFn.toMacAddress(modelInfo_view.epon_mac) }" disabled="disabled" /></td>
						</tr>
						<tr>
							<th>검토의견</th>
							<td colspan="5">
								<textarea id="reply_write_contents_02" name= "reply_write_contents_02" placeholder="의견 작성" >${pr_contents.contents_02 }</textarea>
							</td>
						</tr>
						</tbody>
					</table>
                     
               	 	<div class="btnArea">
					<c:if test="${authChk.a2_mail eq 'Y' }">
	                     	<button type="button" class="button reSending" value="재발송">재발송</button>
                     </c:if>
					<c:if test ="${authChk.a2 eq 'Y'}">
              	 	 <c:if test="${requestView.status_cd eq '02'}">
	               	 	 <button class="button" value="${requestView.status_next }">${requestView.status_next }</button>
	                     <c:if test="${requestView.status_cd ne '99'}"><button type="button" class="button rejectBtn" value="반려">반려</button></c:if>
                     </c:if>
                     <c:if test="${requestView.status_cd ne '02'}">
	               	 	 <button class="button" value="수정">수정</button>
                     </c:if>
	            	</c:if>
	            	</div>
	         	</div>
                
                <!-- tabs-3 MGID확정 -->
	         	<div id="tabs-3" >	
					<table class="writeTable" width="100%" border="0" cellspacing="0" cellpadding="0">
	                   <tbody>
						<tr class="default"><th></th><td></td><th></th><td style="width:320px;"></td></tr>
	                    <tr>
	                        <th>POTS명</th>
	                        <td>
	                        	<select name="pots_id" id="pots_id">
                    				<c:if test="${not empty md_list}"> 
                        			<c:forEach var="pots_list" items="${md_list}" varStatus="status"        >  
			                        <option value="${pots_list.id }" data="${pots_list.ip }" <c:if test="${pots_list.id == modelInfo_view.pots_id }">selected="selected"</c:if>>${pots_list.nm} (${pots_list.ip })</option>
			                       </c:forEach>
			                       </c:if>
		                        </select>
		                    </td>
	                        <th>AGW IP</th>
	                        <td>
	                        	<div id="megacoIP"></div>
	                        	<input type="hidden" name="megaco_ip" id="megaco_ip" value="${modelInfo_view.megaco_ip}"/>
	                        	<input type="hidden" name="megacoIpDupliChk" id="megacoIpDupliChk" value="${modelInfo_view.megaco_ip }" />
								<button type="button" class="button dupliMIPChk">중복체크</button>
	                        </td>  
	                    </tr>
	                    <tr>
	                    	<th>MGID</th>
	                        <td><input type="number" min="0" max="9999" maxlength="4" name="mg_id" value="${modelInfo_view.mg_id eq null? '0' : modelInfo_view.mg_id}"/></td>
	                    	<th>START LLN</th>
	                        <td><input type="number" min="0" max="9999999" maxlength="7"  name="start_lln" value="${modelInfo_view.start_lln eq null? '0' : modelInfo_view.start_lln }"/></td>
	                    </tr>
	                    <tr>
	                     	<th>IPSec-서버 IP</th>
	                         <td>
	                         	<c:set var="ipsec_cnt" value="0" />
	                        	<select name="ipsec_ip" id="ipsec_ip">
                    				<c:if test="${not empty md_list2}"> 
                        			<c:forEach var="ipsec_list" items="${md_list2}" varStatus="status">  
			                        <option value="${ipsec_list.id }" <c:if test="${ipsec_list.id == modelInfo_view.ipsec_ip }">selected="selected"<c:set var="ipsec_cnt" value="${ipsec_cnt+1 }" /></c:if>>${ipsec_list.nm } (${ipsec_list.ip})</option>
			                       </c:forEach>
			                       </c:if>
		                       <fmt:formatNumber var="ipsec_cnt" value="${ipsec_cnt }" type="number" />
		                       <c:if test="${modelInfo_view.ipsec_ip != null && modelInfo_view.ipsec_ip != '' && ipsec_cnt == 0 }">
		                       		<option value="${modelInfo_view.ipsec_ip }" selected="selected">${modelInfo_view.ipsec_info_nm } (${modelInfo_view.ipsec_info_ip })</option>
		                       </c:if>
	                        	</select>
	                        </td>
	                        <th>EMS IP</th>
	                        <td>
	                        	
	                        	<select name="ems_ip" id="ems_ip">
                    				<c:if test="${not empty md_list3}"> 
                        			<c:forEach var="emsIp_list" items="${md_list3}" varStatus="status">  
			                        <option value="${emsIp_list.id }" 
			                        	<c:if test="${emsIp_list.id == modelInfo_view.ipsec_ip }">
			                        		selected="selected"
			                        	</c:if>
			                        >${emsIp_list.mih_ip} (공인IP ${emsIp_list.ktis_ip })</option>
			                       </c:forEach>
			                       </c:if>
		                        </select>
	                        </td>
	                    </tr>
	                   	<tr>
						<th>검토의견</th>
						<td colspan="3">
							<textarea style="height:50px;" id="reply_write_contents_03" name= "reply_write_contents_03" placeholder="의견 작성" >${pr_contents.contents_03 }</textarea>
						</td>
						</tr>
	                    </tbody>
               	 	</table>
                     
               	 	<div class="btnArea">
               	 	<c:if test="${authChk.a3_mail eq 'Y' }">
	                     	<button type="button" class="button reSending" value="재발송">재발송</button>
	                     	<button class="button" value="시설정보를 EMS로 전송" id="sendEms_1000" name="sendEms">EMS 전송</button>
                     </c:if>
               	 	<c:if test ="${authChk.a3 eq 'Y'}">
              	 	 <c:if test="${requestView.status_cd eq '03'}">
	               	 	 <button class="button" value="${requestView.status_next }">${requestView.status_next }</button>
	                     <c:if test="${requestView.status_cd ne '99'}"><button type="button" class="button rejectBtn" value="반려">반려</button></c:if>
                     </c:if>
                     <c:if test="${requestView.status_cd ne '03'}">
	               	 	 <button class="button" value="수정">수정</button>
                     </c:if>
	            	</c:if>
	            	</div>
	            </div>

				<!-- tabs-5 COLCODE 확정 -->
	         	<div id="tabs-5" >
					<table class="writeTable" width="100%" border="0" cellspacing="0" cellpadding="0">
	                   <tbody>
	                   	<%-- <tr>
	                   		<th>주소</th>
	                   		<td><input type="text" id="address" value="${faciInfo.address }" required disabled="disabled" /></td>
	                   	</tr>
	                   	<tr>
	                   		<th>본부 > 센터 > 팀</th>
	                   		<td><input type="text" id="office_nm" value="${faciInfo.office_nm }" required disabled="disabled" /></td>
	                   	</tr> --%>
	                   	<tr>
	                   		<th>OLT IP</th>
	                   		<td><input type="text" value="${modelInfo_view.managed_ip }" disabled="disabled" />
	                   	</tr>
	                    <tr>
	                        <th>COLCODE 입력</th>
	                        <td><input type="text" name="colcode" id="colcode" maxlength="9" value="${modelInfo_view.colcode }"/></td>
	                      </tr>
	                      <tr>
	                        <th>검토의견</th>
	                        <td>
	                        	<textarea id="reply_write_contents_05" name="reply_write_contents_05"  placeholder="의견 작성" >${pr_contents.contents_05 }</textarea>
	                        </td>
	                    </tr>
	                    </tbody>
               	 	</table>
               	 	<div class="btnArea">
               	 	<c:if test ="${authChk.a5 eq 'Y'}">
              	 	 <c:if test="${requestView.status_cd eq '05' && !requestView.request_yn}">
	               	 	 <button class="button" value="${requestView.status_next }">${requestView.status_next }</button>
	               	 	 <c:if test="${requestView.status_cd ne '99'}"><button type="button" class="button rejectBtn" value="반려">반려</button></c:if>
                     </c:if>
                     <c:if test="${requestView.status_cd eq '05' && requestView.request_yn }">
						<button type="button" class="button reSending" value="재발송">재발송</button>
						<button class="button" value="COLCODE를 EMS로 전송" id="sendEms_1002" name="sendEms">COLCODE EMS전송</button>
	                    <button class="button" value="시설정보를 삭제요청" id="sendEms_1003" name="sendEms">시설정보 EMS삭제</button>
	               	 	<button class="button" value="수정">수정</button>
                     </c:if>
	            	</c:if>
	            	</div>
	         	</div>
	         	</form>
	         	
	         	<form method="POST" name="constructForm" id="constructForm" action="construct_write" target="pageRefreshing" onSubmit="return FormChkModule(this);">
         		<input type="hidden" name="neoss_no" value="${requestView.neoss_no}"/>   
	            <input type="hidden" name="constNo" value="${csVO.const_no}"/>
	            <input type="hidden" name="cnstType" id="cnstType" value="${requestView.status_cd}"/>  
	            <input type="hidden" name="contents" id="contents" value=""/>  
	            <input type="hidden" name="request_yn" id="request_yn" value="${requestView.request_yn}">
	            <input type="hidden" name="status_cd" id="status_cd" value="${requestView.status_cd}">
	            <input type="hidden" name="prev_status" name="prev_status" />
                <input type="hidden" name="process_no" id="process_no" value="${pr_contents.process_no_04 eq null ? '0' : pr_contents.process_no_04}">
				<!-- tabs-4 공사정보 -->
	         	<div id="tabs-4" >
			             <div  id="cnstStDiv" >
						<table class="writeTable" style="margin:0; border-top-width:1px; "  width="100%" border="0" cellspacing="0" cellpadding="0">
							<tbody>
							<tr>
								<th>협력사</th>
								<td>
									<ul class="exList">
									<c:if test="${not empty exMailList }">
										<c:forEach var="vo" items="${exMailList }">
										<li>
											<b>${vo.ex_company_nm}</b> <${vo.emp_name }> ${vo.email_address }									
											<input type="hidden" name="mem_04_id" id="mem_04_id" value="${vo.no_emp }" readonly="readonly"/>
										</li>
										</c:forEach>
									</c:if>
									<c:if test="${not empty csmemVO }">
										<c:forEach var="vo" items="${csmemVO }">
										<li>
											<b>${vo.ex_company_nm}</b> <${vo.emp_name }> ${vo.email_address }
										</li>
										</c:forEach>
									</c:if>
									</ul>
									<c:if test="${ empty csmemVO }">
									<button type="button" class="button" id="b_01" name="exSearchBtn"><span class="ui-icon ui-icon-search"></span></button>
									</c:if>
								</td>
							</tr>
							<tr>
								<th>공급일</th>
								<td>
									<fmt:parseDate var="parsedDate" value="${csVO.st_dt}" pattern="yyyy-MM-dd"/>
									<fmt:formatDate var="newFormattedDateString" value="${parsedDate}" pattern="yyyy-MM-dd"/> 
									<input type="text" class="datepicker" name="st_dt" id="st_dt" readonly="readonly" value="${newFormattedDateString }" />
								</td>
							</tr>
							<tr>
								<th>검토의견</th>
								<td><textarea name="const_st_desc" id="reply_write_contents_04">${pr_contents.contents_04}</textarea></td>							
							</tr>
							</tbody>
						</table>
	                    
						<div class="btnArea">
						<c:if test="${authChk.a4_mail eq 'Y' }">
	                     	<button type="button" class="button reSending" value="재발송">재발송</button>
                     </c:if>
						<c:if test ="${authChk.a4 eq 'Y'}">
	              	 	 <c:if test="${requestView.status_cd eq '04'}">
		               	 	 <button class="button" value="${requestView.status_next }">${requestView.status_next }</button>
		               	 	 <c:if test="${requestView.status_cd ne '99'}"><button type="button" class="button rejectBtn" value="반려">반려</button></c:if>
	                     </c:if>
	                     <c:if test="${requestView.status_cd ne '04'}">
		               	 	<button class="button" value="수정">수정</button>
	                     </c:if>
			            </c:if>
			            </div>
	                </div>
                </div>
                </form>
			</div>		
		</div>

		<table class="listTable notLink"  border="0" cellspacing="0" cellpadding="0">
			<thead>
			<tr> 
				<th width="40">No</th>
				<th width="100">날짜</th>
				<th width="100">승인상태</th>
				<th width="150">부서</th>
				<th width="80">검토자</th>
				<th width="110">연락처</th>
				<th>검토 의견</th>
			</tr>
			</thead>
			<tbody>
			<c:forEach var="vo" items="${processView}" varStatus="status">
			<!-- class="disabled" -->
			<tr <c:if test="${!vo.current_yn}"> class="disabled"</c:if>>
				<td>${vo.rnum }</td>
				<td>
					<fmt:parseDate var="parseDate" value="${vo.input_dt }" pattern="yyyy-MM-dd HH:mm:ss"/>
					<fmt:formatDate var="input_dt" value="${ parseDate }" pattern="yy/MM/dd HH:mm" />
					${input_dt}
				</td>
				<td><b>${vo.status eq 'MAC확정 & EMS전송 확정'? 'MAC확정': vo.status}</b></td>
				<td>${vo.branch_nm}</td>
				<td>${vo.emp_name}</td>
				<td>${paramFn.toTelNum(vo.phone_number) }</td>
				<td><div style="padding:0 10px 0 10px;">${fn:replace(vo.contents, enter, '<br>')}</div></td>
			</tr>
			</c:forEach>
			</tbody>
		</table>  
		
		<c:if test="${not empty requestViewHistory }">
		<div class="divDocTitle pt50" id="neoss_history_area"><span id="history_btn">이력보기 <span class="ui-icon ui-icon-caret-1-s"></span></span></div>
        	<div id="history_list">
				<table class="listTable notLink" border="0" cellspacing="0" cellpadding="0">
					<thead>
					<tr>
		                <th width="100">순번</th>
		                <th width="150">최종등록일</th>
		                <th width="100">최종등록자</th>
		                <th width="110">연락처</th>
		                <th>부서</th>
			        </tr>
					</thead>
					<tbody>
					  <c:forEach var="requestViewHist" items="${requestViewHistory}" varStatus="status"> 
						<tr style="cursor:pointer" onclick="open_pop('${requestViewHist.neoss_no}','${requestViewHist.history_no}', this);">
							<td>${requestViewHist.rnum}</td>
							<td>${requestViewHist.time_stamp}</td>
							<td>${requestViewHist.update_id }</td>
							<td>${paramFn.toTelNum(requestViewHist.phone_number) }</td>
							<td class="left">${requestViewHist.office_nm }</td> 
						</tr>
					  </c:forEach>
					</tbody>
				</table>   
			</div>
		</c:if>

	</div>
</section>
<!-- 직원검색 -->
<div id="mask"></div>
<div class="window">
	<jsp:include page="../include/usr_exSearch.jsp" flush="false"></jsp:include>
</div>
<div id="dialog_del"   title="삭제" >
</div>
<iframe name="pageRefreshing" src="" frameborder="0" width="0" height="0"></iframe>
<%@ include file = "/resources/inc/footer.jsp" %>
<script>
var msg = "${msg}";
var idx = '${requestView.status_cd}';	
var status_cd = '${requestView.status_cd}';	
var prev_status = '${requestView.prev_status}';
var neoss_no = '${requestView.neoss_no}';
var st_dt = '${newFormattedDateString }';
var supply_dt = '${requestView.supply_dt }';
var param = "${pageInfo.param}";

var managedIP = $('#managedIP').ipInput();
var gwIP = $("#gwIP").ipInput();
var megacoIP = $("#megacoIP").ipInput();

function FormChkModule(f) {
	var status = f.status_cd.value;
	var action = f.action;
	var msg = "";
	console.log(action);
	if (action.indexOf("/4p/process_write") > 0 || action.indexOf("/4p/construct_write") > 0 || action.indexOf("/4p/process_modi") > 0) {
		// 투자확정
		if (status == '01') {
			msg = "투자확정";
			if (f.reply_write_contents_01.value == "") {
				alert("의견을 입력해 주세요");
				f.reply_write_contents_01.focus();
				return false;
			} else {
				f.contents.value = f.reply_write_contents_01.value;
			}
		}
		// IP 확정
		if (status == '02') {
			msg = "IP&MAC확정";
			if (f.kuksa_nm.value == "") {
				alert("설치국사를 입력해 주세요");
				f.kuksa_nm.focus();
				return false;
			}
			if (f.olt_nm.value == "") {
				alert("OLT이름을 입력해 주세요");
				f.olt_nm.focus();
				return false;
			}
			var managed_ip = managedIP.getIp();
			if (managed_ip == undefined || managed_ip == "") {
				alert("OLT IP를 입력해 주세요");
				$("#managedIP .ip-input-item:eq(0)").focus();
				$("#managedIP .ip-input-item:eq(0)").select();
				return false;
			} else {
				f.managed_ip.value = managed_ip;
			}
			if (f.managedIpDupliChk.value == "" || f.managedIpDupliChk.value != f.managed_ip.value) {
				alert("OLT IP 중복체크를 해 주세요.");
				return false;
			}
			var gw_ip = gwIP.getIp();
			if (gw_ip == undefined || gw_ip == "") {
				alert("GATEWAY를 입력해 주세요");
				$("#gwIP .ip-input-item:eq(0)").focus();
				$("#gwIP .ip-input-item:eq(0)").select();
				return false;
			} else {
				f.gw_ip.value = gw_ip;
			}
			if (f.mac_after.value == "") {
				alert("MAC 정보를 입력해 주세요.");
				f.mac_after.focus();
				return false;
			} else {
				if (f.mac_after.value.length != 6) {
					alert("MAC 정보를 리스트에서 선택해 주세요.");
					f.mac_after.focus();
					return false;
				}else {
					f.mac.value = f.mac_before.value + f.mac_after.value.toUpperCase();
					//alert(f.mac.value);
				}
			}
			 if (f.epon_mac.value == "") {
				alert("Epon MAC이 입력되지 않았습니다.\nMAC 정보를 다시 입력해 주세요.");
				f.mac_after.focus();
				return false;
			} 
			if (f.reply_write_contents_02.value == "") {
				alert("의견을 입력해 주세요");
				f.reply_write_contents_02.focus();
				return false;
			} else {
				f.contents.value = f.reply_write_contents_02.value;
			}
		}
		// MGID 확정
		if (status == "03") {
			msg = "MGID확정"
			if (f.pots_id.value == "") {
				alert("POTS명을 입력해 주세요.\n데이터가 없는 경우 관리자에게 문의 바랍니다.");
				f.pots_id.focus();
				return false;
			}
			var megaco_ip = megacoIP.getIp();
			if (megaco_ip == undefined || megaco_ip == "") {
				alert("AGW IP를 입력해 주세요.")
				$("#megacoIP .ip-input-item:eq(0)").focus();
				$("#megacoIP .ip-input-item:eq(0)").select();
				return false;
			}else {
				f.megaco_ip.value = megaco_ip;
			}
			if (f.megacoIpDupliChk.value == "" || f.megacoIpDupliChk.value != f.megaco_ip.value) {
				alert("AGW IP 중복체크를 해 주세요.");
				return false;
			}
			if (f.mg_id.value == "" || f.mg_id.value == "0") {
				alert("MGID를 입력해 주세요.");
				f.mg_id.select();
				f.mg_id.focus();
				return false;
			}
			if (f.start_lln.value == "" || f.start_lln.value == "0") {
				alert("START LLN을 입력해 주세요.");
				f.start_lln.select();
				f.start_lln.focus();
				return false;
			}
			if (f.reply_write_contents_03.value == "") {
				alert("의견을 입력해 주세요.");
				f.reply_write_contents_03.focus();
				return false;
			} else {
				f.contents.value = f.reply_write_contents_03.value;
			}
		}
		// 착공(공사요청)
		if (status == "04") {
			msg = "착공(공사요청)";
			var result = "OK";
			$("input[name='mem_04_id']").each(function(){
				if ($(this).val() == null) {
					result = "empty";
					return false;
				} else {
					result = "OK";
				}
			});
			if (result == "empty"){
				alert("협력사를 입력해 주세요");
				return false;
			}
			var st_dt = $("#st_dt");
			if (st_dt.val() == ""){
				alert("착공일을 입력해 주세요");
				st_dt.focus();
				return false;
			}
			var const_st_desc = $("#reply_write_contents_04");
			if (const_st_desc.val() == ""){
				alert("의견을 입력해 주세요");
				const_st_desc.focus();
				return false;
			} else {
				f.contents.value = const_st_desc.val();
			}
		}
		//COLCODE 확정
		if (status == "05") {
			msg = "COLCODE확정";
			if (f.colcode.value == "") {
				alert("COLCODE를 입력해 주세요.");
				f.colcode.focus();
				return false;
			} else {
				if (f.colcode.value.length != 9) {
					alert("COLCODE를 정확히 입력해 주세요.");
					f.colcode.select();
					f.colcode.focus();
					return false;
				}
			}
			if (f.reply_write_contents_05.value == "") {
				alert("의견을 입력해 주세요.");
				f.reply_write_contents_05.focus();
				return false;
			} else {
				f.contents.value = f.reply_write_contents_05.value;
			}
		}
		// 반려
		/* if (status == "99") {
			msg = "반려";
		} */
		if (confirm(msg +" 하시겠습니까?")) {
			var da = $("#tabs"+status).attr('data');
			//alert(da);
			if(da != ''){
				$("input[name=process_no]").val($("#tabs"+status).attr('data'));
			}
			$.blockUI();
			return true;
		} else {
			return false;
		}
	} else if (action.indexOf("/4p/reWriteMail") > 0) {
		$.blockUI();
		return true;
	} else if (action.indexOf("/4p/process_back") > 0) {
		if (confirm("반려 하시겠습니까?")) {
			$.blockUI();
			return true;
		} else {
			return false;
		}
	}
	
}
</script>
</body>
</html>